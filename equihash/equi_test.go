package equihash

import (
	"encoding/hex"
	"testing"
)

func decodePanic(s string) []byte {
	data, err := hex.DecodeString(s)
	if err != nil {
		panic(err)
	}

	return data
}

func TestVerify(t *testing.T) {
	table := []struct {
		N           int
		K           int
		HeaderNonce string
		Solution    string
	}{
		{
			N:           200,
			K:           9,
			HeaderNonce: "04000000a5b08eb465d564c690c31c08e9600110c1026f9557de51a85ebbeac35e0a00009e177df268efc2f9010938fd6cc38c634e645e4bfc369e99706564ebde801f120000000000000000000000000000000000000000000000000000000000000000b52710581a69171e62baff07000000000000000007ffba6110000000000000000000000000000005",
			Solution:    "00401f116f8b6c03fe70c67336d32822efa4fafa084619ad12ab250815ad061981986f790ab014383d22170f74e08d5092d1bdf1b1fca9ed1739d901fe7da76b623e9cb0e766ede1f117d39d4aa3d615b2f5ecc40336453f54d4f6e4a7d0f86ce0c5773a9f1d35daf51e37e5b57449803171f092e432bc0c1d606af0bf530608eeddb6a68c25cf00f624cadd76bf12985f94385d6f9c9d92a889097ab0765cc4f82de6a5b1d552b80091c96b7a170c09e164554626fd8621eb99afc7041362221f976fa513c2a674df1774d6feca8a7f224a0e4dae12fe67d20b4960f1f97aa98d6186074df6ac190b32d7d40749818a5874205b65103559c75d0e2a08734ecc80207a257b43712907c5631540634ce5481968a45b30709b13dae192269ae2a720eac6f1bda30c75ee3ba0667735be8a91642343d7e253d8b43d2311e5f1916f49a5259249e1aa2a5adc192c35fb718f009a5a819691cf5ccee3b2d23a32e1a6cf1fb787483f45d4f8b5224fdbcb49d64b06d721228b689e4765191c2579e8a0baf936077622c759127bad429f2bd045bf53ee7b134b19c0be05a6a0623d36f7c7d811a507a133fd864c1d9ae51aa4fa63da30ef6dca7d508b72334f74dcf09299eb3eba5fb2692deb10011ff2c91c327757b1dfa82574e4242235f79245db2c78bd421d2d7c90be5f2a85da4d9662c84e2be29a435a57010af7c1d6a21e3f0bd6dd81ef5e7855bde6a4de8c620c4d2084e129ca4bd887038f78ac90cd7450fe6114102f0ff6a3d22e255cca017f3c210f7145a5f070d4238575340d21d3fd31dec2ff663c91a96f983779e50bb8f7ad49891c2b136a23b5ffb7b1cdd6c512a2922bb832ea849400173a2cb7bf7be46f25ff96741c030d5fd604015dda67d389f4137ea190593d4e94434b14b899041b503c7bf4cea223e57e04d53d7656ace5056f2727758723ed41df3432f27129d9820aaf5e6251016ae84ea73ccd490c1546e9af0b49f2b397b7d911da7b77153ec4d9f8fae3137b6952c766c43e93266cc92d22ee3266fdacd6b846c8cb5bd68cf85eb4f1059ab93342f8a481d6ea21c126abcaca67601c1d25135e7ab449b0997ddd1d41ec4ab8ade9188a962f960edc11dc4a53b65f35a3f513d4b9095b1e3f7b88a725a1163eadd077bad957e3f81b562626ebdd3c765708547766a985a76cfb7f14cefa675225c872770acc09acfe1ccd1e4b313bf762664ece75b9bcdcf6f1180f25f40d304fd5e2f2489266987ccfc5712494b05d4952b79492a2ed737e7af6005ae441f587d1cea603088d2217eeceb922bed715ee95d08cea5639f8e749545c2606aa1eb579a9de7572c150c96e0782d84c3d259a15b1d891b0c9623764c9f14f857dabd7ed8e693a8aff3ed2ef5261f756778d8b3d5cdf11e3dc831305b0310a05db65b8f51211b2bb2f4d6888208ae9da176da5264a903774f1482365636846faa3c33780a819389209aac983466b1064fd4f4bcc2da6f01b4a2c373677a064e31325cd21039823b4d828f3a15de2b30a8a39635de0e6196224934c46295fd2a20838541b0ca363ae9d83af7eea759301d629e2b9e5361f660113abda185b88d2be86f8f1bac71c32765260bdf3a323c8d98cb09757b5c433c9dc256a1c0eff7c1c3ae90610d8425aec30bd748ff2f2014e9b61d76bfec8e6257c06c36258a264fa1024c037bcb7827c6657441806f3e3152e055531f934a0aed1ce723cdea9311dfb0eedb1839563f567dc33b27c8f20160d9a75b8fd8006f05c4fc4c713b1239f6147cb3fd69a37391416f31be15aebfac7bc7ea70e1254a339bd3ab1345cf7ce2e4a1ecae8ced9b0cea0e37cdb1f63edeae571321249ee8277051a0894dd431ace4d78d31f1950deadf7",
		},
		{
			N:           200,
			K:           9,
			HeaderNonce: "04000000f1a3f300a01fd899a9cf5b1b0594a58c1f88d056858d8ab8492a24149e040000da2a4fa18be9eae2c6f138b69bf9dfa09e6e4445686e2c21399e859f0dac8f190000000000000000000000000000000000000000000000000000000000000000dca810583a970b1e3d01000000000000000000000000000000000000000000000000000000000000",
			Solution:    "01285c1eb6429fa6b23624ce1cc7278a88853a3ef238f185da901ea1dd1b5d24455ac0ee8f29d3ff2d9b022b52e5a9178b3afc1c716b3f24db2877f132794016468c8523f18fd5d2f7e31115e8b9d2ec5cda86bb07cfbf99e80bfc6dabf4925a99224c2b02f01f11d90fbfef2e001a772d246fa1d358687174cea57ec1b8140f5aac5f1832bfbe00f229fdbbc7197290526c7c1c684239c85f78d14c74f59ced55ec7b182c9ce73d014ad99a19931cdadbb1b2b5d75d557d0f83d5190f34b3aa7c1b2206f371ef47c3ae408bbaec9a38a0441780dd2bb976f12de954735a2b1bdda2521b5f9a2a286b935be7ede0bfe9d854268c396d4e2920bedab20e2a6115b7994cdf77d305117f299dc1b232cecf2838844bc95b6e2791a6f525873574e6ae55e07cfe7b172acd90ed618acf2b62d32f33331f7d32f20a5135302f8bc36d57dde3e793583e5b69c096522c548baf028774863556ca17c346c4feb93ffa233af59a3b621e65b1e191dfd8adeb7218b5d5c90442514399cfc5042dfd6775db1def917cd6e314ce4379db5774bbcd2edb85b65b5903affee6937eeea75baced9efce88a0deccaed7b99cdcd7cea53f9c478ef820f1ef0ebd31857765d5d9f552d3d59b5322769aa374fdd1cfab30ff1c31df28e66e9f0653206a25f7bf26f055b79cb1d44eb0ff621306bd83335f5b1e121ded742d77499042816dc90c54eae8288f1a2a626273d57ecd5d68231acc4254d10d8bbb44619237b5c629e5b7653d95514012c27084be810a59fd7de1afd6ed2d2925984185347fbdff5a1825b0dd9757216d6c7718c76ddad2b08981d735ddd405b0e6b613757ce163f5d6ddd49b30ed99a0ce30e81ccfac032033ad36f8651bb5ef40b0ce4ed6caa9812e75503ca0e3bda281ecefb37dd4427c4d179ae6a3a13b7f9047e7add043daf143769910214fedb404186bf09e4711f74cb54e8d0b42c0c69508c737c5edc9d9d0d3aa6fdb2b8e0a38eb61eb4d40e5d01b5b2aceda1d54442c3b25184c30b90bbe25f1152bc0b14acb271b45da57598dec4061f76faa1ed1193b3ee9c8aaca3c808c65aeb7dd6e9f66f11dd0a271c52a660dba96ced8b03a3c4417f258a5e70172a26cca466456742ad88fa33ed08660bd66393180f2346b532fbcbd8da5d81ca869ae03d1ee63defdcd53b0c7d6722dc47ba6440478730bb5cd06e33fefc4a50535153130ba12b4dc74ce6a0b1f0c33a3afb3454ed0da8739267598d88fe8422c0c51f08bd105d9cbede0ed9b795904dda51decd260b6245751b03269acfa60e422a064389f5f158fbda2c3066ab42ac4737f7b61e0895222e1306597e2853c526eaedbe256774c8500e96bd8e300daa44cf36d2b3e07b104ee228dd0eba3a8d36a48755f3657998f5ad8c7d37c59dd8af3723022f898ed8248115325296ec4a4dab65fd297a7dd60fb1aa5ff41fa490ff4be8f5bddec80ee06c77c30f0884c61acd0a6e95a7e2f18cb3f27a31ebfc5e3156092883fa99f997d5fb89e1ff10ffaba6d82ddbaece02782201b8864844983bc0aab7cd6cd1e85e74164d1a3be30c4bc763a74a54b271e7535a6997387cb2222a696f10d410fc47f7bd14bbafcd5329d21878cf192ee1b487db0e9951a544b6a3db3f2316042e3e7c6403375576d5fa80afd5b0f28616db3bb768485e7a2412f031c9b82290e9d449055911545685b8191f51d6056408f4b937014ddb8d3303df30be3919d7d9f6aa25b031d9c38e3d6daa9df5257a362be98898158de906f28505d602f1cbbb2e722de54ee09d8e77d84ae81c6fd93fa556083f7e23c82d8b4cff3aa3e85882e534479c5f7b390175e98a334e5fe985fa47ee556f2a612a162eeee6d6afd50f08a455d1371eb2a1f72cfe",
		},
	}

	for _, v := range table {
		ok, err := Verify(v.N, v.K, decodePanic(v.HeaderNonce), decodePanic(v.Solution))
		if err != nil {
			t.Fatal(err)
		}

		if !ok {
			t.Fatal(err)
		}
	}
}
